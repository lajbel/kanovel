{
  "version": 3,
  "sources": ["../kanovel.ts"],
  "sourcesContent": ["import kaboom from \"kaboom\";\n\n// Typescript Definitions\ndeclare global {\n\t/**\n\t * Define a Character\n\t *\n\t * @example\n\t * ```js\n\t * character(\"b\", \"Beany\", \"beany\");\n\t * ```\n\t */\n\tfunction character(\n\t\t/**\n\t\t * Identifier to use the character\n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Name of the character for appears on the game\n\t\t */\n\t\tname: string,\n\t\t/**\n\t\t * Sprite for use it whit show()\n\t\t */\n\t\tsprite: string\n\t): void;\n\n\t/**\n\t * Define a Chapter\n\t *\n\t * @example\n\t * ```js\n\t * chapter(\"start\", () => [\n\t *     prota(\"Ohh today is a great day!\"),\n\t *\t   prota(\"I want...\"),\n\t *\t   prota(\"I want to live a visual novel life!\"),\n\t * ]);\n\t * ```\n\t */\n\tfunction chapter(\n\t\t/**\n\t\t * The title of the chapter\n\t\t */\n\t\ttitle: string,\n\t\t/**\n\t\t * Events of the chapter\n\t\t */\n\t\tevents: any[]\n\t): void;\n\n\t/**\n\t * Jump to other chapter\n\t */\n\tfunction jump(\n\t\tchapter: string\n\t): void;\n\n\t/**\n\t * Write as the protagonist or a narrator\n\t */\n\tfunction prota(dialog: string): void;\n\n\t/**\n\t * Write as a character\n\t */\n\tfunction char(\n\t\t/**\n\t\t * The character's id \n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Text to say\n\t\t */\n\t\ttext: string,\n\t): void;\n}\n\n\n// KaNovel Plugin\nexport default function kanovel(k) {\n\tk.scene(\"vn\", () => {\n\t\t// Layers of the game\n\t\tlayers([\"backgrounds\", \"characters\", \"textbox\"]);\n\n\t\tconst textboxBG = add([\n\t\t\tsprite(\"textbox\"),\n\t\t\tk.origin(\"bot\"),\n\t\t\tlayer(\"textbox\"),\n\t\t\tz(0),\n\t\t\tpos(width() / 2, height() - 20),\n\t\t\t{\n\t\t\t\tisWriting: false,\n\t\t\t},\n\t\t]);\n\n\t\tonLoad(() => {\n\t\t\tthis.textbox = add([\n\t\t\t\ttext(\"\", { size: 30, width: textboxBG.width - 50 }),\n\t\t\t\tlayer(\"textbox\"),\n\t\t\t\tz(1),\n\t\t\t\tpos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 50 /*pad*/,\n\t\t\t\t\t\ttextboxBG.height - 30 /*pad*/\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tthis.namebox = add([\n\t\t\t\ttext(\"\", { size: 40 }),\n\t\t\t\tlayer(\"textbox\"),\n\t\t\t\tz(2),\n\t\t\t\tpos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 30,\n\t\t\t\t\t\ttextboxBG.height + 30\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tthis.passDialogue();\n\t\t});\n\n\t\t// Default input for Visual Novel\n\t\tonUpdate(() => {\n\t\t\tif (isMousePressed() || isKeyPressed(\"space\")) {\n\t\t\t\tthis.passDialogue();\n\t\t\t}\n\t\t});\n\t});\n\n\treturn {\n\t\tchapters: new Map(),\n\t\tcharacters: new Map(),\n\t\tcurDialog: \"\",\n\t\tcurChapter: \"start\",\n\t\tcurEvent: 0,\n\n\t\t// Visual Novel Making Functions\n\n\t\tcharacter(id: string, name: string, sprite: string) {\n\t\t\treturn this.characters.set(id, {\n\t\t\t\tname: name,\n\t\t\t\tsprite: sprite,\n\t\t\t});\n\t\t},\n\n\t\tchapter(title: string, events: any) {\n\t\t\tif (this.chapters.get(title)) {\n\t\t\t\tthrow new Error(`You can't repeat the chapter name! \"${title}\"`);\n\t\t\t}\n\n\t\t\treturn this.chapters.set(title, events());\n\t\t},\n\n\t\tjump(chapter) {\n\t\t\treturn () => this.changeChapter(chapter);\n\t\t},\n\n\t\t// History making functions\n\n\t\tprota(dialog: string) {\n\t\t\treturn () => this.write(\"\", dialog);\n\t\t},\n\n\t\tchar(id: string, dialog: string) {\n\t\t\treturn () => this.write(this.characters.get(id), dialog);\n\t\t},\n\n\t\tshow(charId) {\n\t\t\treturn () => this.showChar(this.characters.get(charId));\n\t\t},\n\n\t\tbg(sprite) {\n\t\t\treturn () => this.changeBackground(sprite);\n\t\t},\n\n\t\t// Core Functions\n\n\t\twrite(char: any, dialog: string) {\n\t\t\tif (char) this.namebox.text = char.name;\n\t\t\telse this.namebox.text = \"\";\n\n\t\t\tthis.textbox.text = \"\";\n\t\t\tthis.curDialog = dialog;\n\n\t\t\tfor (let i = 0; i < dialog.length; i++) {\n\t\t\t\twait(0.05 * i, () => (this.textbox.text += dialog[i]));\n\t\t\t}\n\t\t},\n\n\t\tcheckAction(action) {\n\t\t\tif (action.length) {\n\t\t\t\tfor (const act of action) this.checkAction(act);\n\t\t\t} else {\n\t\t\t\taction();\n\t\t\t}\n\t\t},\n\n\t\tpassDialogue() {\n\t\t\tif (this.textbox.text !== this.curDialog) return;\n\n\t\t\tthis.checkAction(this.chapters.get(this.curChapter)[this.curEvent]);\n\n\t\t\tthis.curEvent++;\n\t\t},\n\n\t\tshowChar(char) {\n\t\t\tadd([\n\t\t\t\tsprite(char.sprite),\n\t\t\t\tk.origin(\"center\"),\n\t\t\t\tpos(center()),\n\t\t\t\tlayer(\"characters\"),\n\t\t\t]);\n\t\t},\n\n\t\tchangeBackground(spr) {\n\t\t\tevery(\"background\", (bg) => {\n\t\t\t\tbg.use(lifespan(1, { fade: 0.5 }));\n\t\t\t});\n\n\t\t\tconst bg = add([\n\t\t\t\tsprite(spr),\n\t\t\t\tk.origin(\"center\"),\n\t\t\t\tz(0),\n\t\t\t\tpos(center()),\n\t\t\t\tlayer(\"backgrounds\"),\n\t\t\t\t\"background\",\n\t\t\t]);\n\n\t\t\tbg.use(z(0));\n\t\t},\n\n\t\tchangeChapter(chapter) {\n\t\t\tif (!this.chapters.get(chapter)) {\n\t\t\t\tthrow new Error(`\"${chapter} chapter don't exists!\"`);\n\t\t\t}\n\n\t\t\tthis.curChapter = chapter;\n\t\t\tthis.curEvent = 0;\n\n\t\t\tthis.passDialogue();\n\t\t},\n\t};\n}\n"],
  "mappings": "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",
  "names": []
}
