{
  "version": 3,
  "sources": ["../code/kanovel.ts"],
  "sourcesContent": ["import { KaboomCtx, Vec2 } from \"kaboom\";\n\n// Typescript Definitions for KaNovel \uD83D\uDC8B\n\ninterface Character {\n\tname: string;\n\tsprite: string;\n\texpressions: CharacterExpression[]\n}\n\ninterface CharacterExpression {\n\tname: string;\n\tsprite: string;\n}\n\ninterface TextboxOpt {\n\tsprite?: string;\n\twidth?: number;\n\theight?: number;\n}\n\ninterface KaNovelOpt {\n\ttextbox: TextboxOpt;\n}\n\ndeclare global {\n\t/**\n\t * Simply config your Visual Novel\n\t*/\n\tfunction kanovel(\n\t\tconfig: KaNovelOpt\n\t);\n\n\t/**\n\t * Define a Character\n\t *\n\t * @example\n\t * ```js\n\t * character(\"b\", \"Beany\", \"beany\");\n\t * ```\n\t */\n\tfunction character(\n\t\t/**\n\t\t * Identifier to use the character\n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Name of the character for appears on the game\n\t\t */\n\t\tname: string,\n\t\t/**\n\t\t * Default sprite for use it whit show()\n\t\t */\n\t\tdefaultSprite?: string,\n\t\t/**\n\t\t * Expressions of the Character\n\t\t*/\n\t\texpressions?: CharacterExpression,\n\t): void;\n\n\t/**\n\t * Define a chapter\n\t *\n\t * @example\n\t * ```js\n\t * chapter(\"start\", () => [\n\t *    prota(\"Ohh today is a great day!\"),\n\t *    prota(\"I want...\"),\n\t *    prota(\"I want to live a visual novel life!\"),\n\t * ]);\n\t * ```\n\t */\n\tfunction chapter(\n\t\t/**\n\t\t * The title of the chapter\n\t\t */\n\t\ttitle: string,\n\t\t/**\n\t\t * Events of the chapter\n\t\t */\n\t\tevents: any[]\n\t): void;\n\n\t/**\n\t * Jump to other chapter\n\t */\n\tfunction jump(\n\t\tchapter: string\n\t): void;\n\n\t/**\n\t * Write as the protagonist or a narrator\n\t */\n\tfunction prota(dialog: string): void;\n\n\t/**\n\t * Write as a character\n\t */\n\tfunction char(\n\t\t/**\n\t\t * The character's id \n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Text to say\n\t\t */\n\t\ttext: string,\n\t): void;\n\n\t/**\n\t * Show a character\n\t*/\n\tfunction show(\n\t\tcharId: string,\n\t\talign: \"center\" | \"left\" | \"right\",\n\t): void;\n\n\t/**\n\t * Show a background\n\t*/\n\tfunction bg(\n\t\t/**\n\t\t * Background's sprite\n\t\t*/\n\t\tsprite: string,\n\t): void;\n\n\t/**\n\t * Play a music\n\t*/\n\tfunction music(\n\t\t/**\n\t\t * Audio loaded with Kaboom `loadAudio()`\n\t\t*/\n\t\tsong: string,\n\t): void;\n}\n\n// Custom Components\n\nfunction fade() {\n\tlet lastTime = 0;\n\n\treturn {\n\t\tid: \"fade\",\n\t\trequire: [\"opacity\"],\n\t\tupdate() {\n\t\t\tif (this.opacity < 1 && time() > lastTime) {\n\t\t\t\tlastTime = time() + 0.010;\n\n\t\t\t\tthis.opacity += 0.025;\n\t\t\t}\n\t\t},\n\t}\n}\n\n// KaNovel Plugin\n\nexport default function kanovelPlugin(k: KaboomCtx) {\n\t// KANOVEL CODE, BASICALLY THE CORE OF THE CORE OF THE CORE\n\n\tlet config;\n\n\tasync function write(dialog: string, character?: Character) {\n\t\tthis.skip = false;\n\t\tthis.textbox.text = \"\";\n\n\t\tlet curCh = 0;\n\n\t\tif (character) {\n\t\t\tthis.namebox.text = character.name;\n\t\t\tthis.curDialog = '\"' + dialog + '\"';\n\t\t}\n\t\telse {\n\t\t\tthis.namebox.text = \"\";\n\t\t\tthis.curDialog = dialog;\n\t\t}\n\t\t\n\t\tfor (let i = 0; i < this.curDialog.length; i++) {\n\t\t\tif(this.skip) break;\n\t\t\t\n\t\t\tawait k.wait(0.05, () => {\n\t\t\t\tif(this.skip) return;\n\t\t\t\t\n\t\t\t\tthis.textbox.text += this.curDialog[i];\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction skipText() {\n\t\tthis.skip = true;\n\n\t\tthis.textbox.text = this.curDialog;\n\t};\n\n\tfunction showCharacter(char: Character, align: \"center\" | \"left\" | \"right\" = \"center\") {\n\t\tnextEvent();\n\n\t\tlet charPos: Vec2 = k.vec2(0, 0);\n\n\t\tif (align === \"center\") charPos = k.center();\n\t\telse if (align === \"left\") charPos = k.vec2(k.width() / 4, k.height() / 2);\n\t\telse if (align === \"right\") charPos = k.vec2(k.width() / 2 + k.width() / 4, k.height() / 2);\n\n\t\tk.add([\n\t\t\tk.sprite(char.sprite),\n\t\t\tk.opacity(0),\n\t\t\tk.origin(\"center\"),\n\t\t\tk.pos(charPos),\n\t\t\tk.layer(\"characters\"),\n\n\t\t\tfade(),\n\t\t]);\n\t}\n\n\tfunction changeBackground(spr: string) {\n\t\tnextEvent();\n\n\t\tk.every(\"bg\", (bg) => {\n\t\t\tbg.use(k.lifespan(1, { fade: 0.5 }));\n\t\t});\n\n\t\tk.add([\n\t\t\tk.sprite(spr),\n\t\t\tk.opacity(0),\n\t\t\tk.origin(\"center\"),\n\t\t\tk.pos(k.center()),\n\t\t\tk.z(0),\n\t\t\tk.layer(\"backgrounds\"),\n\t\t\t\"bg\",\n\n\t\t\tfade(),\n\t\t]);\n\t}\n\n\tfunction changeChapter(chapter: string) {\n\t\tif (!this.chapters.get(chapter)) throw new Error(`\"${chapter} chapter don't exists!\"`);\n\n\t\tthis.curChapter = chapter;\n\t\tthis.curEvent = -1;\n\n\t\tnextEvent();\n\t}\n\n\tfunction playBGMusic(song: string) {\n\t\tnextEvent();\n\n\t\tconst bgm = k.play(song, { loop: true });\n\n\t\tthis.curPlaying.push(bgm);\n\t}\n\n\tfunction nextEvent() {\n\t\tif (this.textbox.text !== this.curDialog) return skipText();\n\n\t\tthis.curEvent++;\n\t\trunEvent(this.chapters.get(this.curChapter)[this.curEvent]);\n\t}\n\n\tfunction runEvent(event) {\n\t\tif (event.length) {\n\t\t\tfor (const e of event) this.runEvent(e)\n\t\t}\n\t\telse {\n\t\t\tevent();\n\t\t}\n\t}\n\n\t// KANOVEL DEFAULT SCENE\n\n\tk.scene(\"vn\", (data) => {\n\t\tlet textboxBG;\n\n\t\tk.layers([\"backgrounds\", \"characters\", \"textbox\"]);\n\n\t\tif (config.textbox?.sprite) {\n\t\t\ttextboxBG = k.add([\n\t\t\t\tk.sprite(\"textbox\"),\n\t\t\t\tk.origin(\"bot\"),\n\t\t\t\tk.layer(\"textbox\"),\n\t\t\t\tk.z(0),\n\t\t\t\tk.pos(k.width() / 2, k.height() - 20),\n\t\t\t]);\n\t\t}\n\t\telse {\n\t\t\ttextboxBG = k.add([\n\t\t\t\tk.rect(config.width || k.width(), config.height || k.height() / 4),\n\t\t\t\tk.origin(\"bot\"),\n\t\t\t\tk.layer(\"textbox\"),\n\t\t\t\tk.z(0),\n\t\t\t\tk.pos(k.width() / 2, k.height() - 20),\n\t\t\t]);\n\t\t}\n\n\t\tk.onLoad(() => {\n\t\t\tthis.textbox = k.add([\n\t\t\t\tk.text(\"\", {\n\t\t\t\t\tsize: 30,\n\t\t\t\t\twidth: textboxBG.width - 70,\n\t\t\t\t}),\n\t\t\t\tk.layer(\"textbox\"),\n\t\t\t\tk.z(1),\n\t\t\t\tk.pos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 50 /*pad*/,\n\t\t\t\t\t\ttextboxBG.height - 30 /*pad*/\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tthis.namebox = k.add([\n\t\t\t\tk.text(\"\", { size: 40 }),\n\t\t\t\tk.layer(\"textbox\"),\n\t\t\t\tk.z(2),\n\t\t\t\tk.pos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 30,\n\t\t\t\t\t\ttextboxBG.height + 30\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tnextEvent();\n\t\t});\n\n\t\t// Default input for Visual Novel\n\n\t\tk.onUpdate(() => {\n\t\t\tif (k.isMousePressed() || k.isKeyPressed(\"space\")) {\n\t\t\t\tnextEvent();\n\t\t\t}\n\t\t});\n\t});\n\n\t// THE REAL KANOVEL PLUGIN \uD83E\uDD8B\uD83E\uDD8B\uD83E\uDD8B\n\n\treturn {\n\t\tcharacters: new Map<string, Character>(),\n\t\tchapters: new Map(),\n\t\tcurDialog: \"\",\n\t\tcurChapter: \"start\",\n\t\tcurEvent: -1,\n\t\tcurPlaying: [],\n\t\tskip: false,\n\n\t\t// Kanovel Config function\n\n\t\tkanovel(c: KaNovelOpt) {\n\t\t\tconfig = c;\n\t\t},\n\n\t\t// Visual Novel Making Functions\n\n\t\tcharacter(id: string, name: string, sprite: string) {\n\t\t\treturn this.characters.set(id, {\n\t\t\t\tname: name,\n\t\t\t\tsprite: sprite,\n\t\t\t});\n\t\t},\n\n\t\tchapter(title: string, events: any) {\n\t\t\tif (this.chapters.get(title)) {\n\t\t\t\tthrow new Error(`You can't repeat the chapter name! \"${title}\"`);\n\t\t\t}\n\n\t\t\treturn this.chapters.set(title, events());\n\t\t},\n\n\t\t// History making functions\n\n\t\tprota(dialog: string) {\n\t\t\treturn () => write(dialog);\n\t\t},\n\n\t\tchar(id: string, dialog: string) {\n\t\t\treturn () => write(dialog, this.characters.get(id));\n\t\t},\n\n\t\tshow(charId: string, align: \"center\" | \"left\" | \"right\" = \"center\") {\n\t\t\treturn () => showCharacter(this.characters.get(charId), align);\n\t\t},\n\n\t\tbg(sprite: string) {\n\t\t\treturn () => changeBackground(sprite);\n\t\t},\n\n\t\tjump(chapter: string) {\n\t\t\treturn () => changeChapter(chapter);\n\t\t},\n\n\t\tmusic(song: string) {\n\t\t\treturn () => playBGMusic(song);\n\t\t},\n\n\t\tburpy(endScene: string = \"end\") {\n\t\t\treturn () => {\n\t\t\t\tk.burp();\n\n\t\t\t\tthis.curPlaying.forEach((a) => a.stop());\n\n\t\t\t\tk.go(endScene);\n\t\t\t};\n\t\t}\n\t};\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;AA4IA,kBAAgB;AACf,QAAI,WAAW;AAEf,WAAO;AAAA,MACN,IAAI;AAAA,MACJ,SAAS,CAAC;AAAA,MACV,SAAS;AACR,YAAI,KAAK,UAAU,KAAK,SAAS,UAAU;AAC1C,qBAAW,SAAS;AAEpB,eAAK,WAAW;AAAA;AAAA;AAAA;AAAA;AAVX;AAkBM,yBAAuB,GAAc;AAGnD,QAAI;AAEJ,mBAAqB,QAAgB,WAAuB;AAAA;AAC3D,aAAK,OAAO;AACZ,aAAK,QAAQ,OAAO;AAEpB,YAAI,QAAQ;AAEZ,YAAI,WAAW;AACd,eAAK,QAAQ,OAAO,UAAU;AAC9B,eAAK,YAAY,MAAM,SAAS;AAAA,eAE5B;AACJ,eAAK,QAAQ,OAAO;AACpB,eAAK,YAAY;AAAA;AAGlB,iBAAS,IAAI,GAAG,IAAI,KAAK,UAAU,QAAQ,KAAK;AAC/C,cAAG,KAAK;AAAM;AAEd,gBAAM,EAAE,KAAK,MAAM,MAAM;AACxB,gBAAG,KAAK;AAAM;AAEd,iBAAK,QAAQ,QAAQ,KAAK,UAAU;AAAA;AAAA;AAAA;AAAA;AArBxB;AA0Bf,wBAAoB;AACnB,WAAK,OAAO;AAEZ,WAAK,QAAQ,OAAO,KAAK;AAAA;AAHjB;AAIR;AAED,2BAAuB,MAAiB,QAAqC,UAAU;AACtF;AAEA,UAAI,UAAgB,EAAE,KAAK,GAAG;AAE9B,UAAI,UAAU;AAAU,kBAAU,EAAE;AAAA,eAC3B,UAAU;AAAQ,kBAAU,EAAE,KAAK,EAAE,UAAU,GAAG,EAAE,WAAW;AAAA,eAC/D,UAAU;AAAS,kBAAU,EAAE,KAAK,EAAE,UAAU,IAAI,EAAE,UAAU,GAAG,EAAE,WAAW;AAEzF,QAAE,IAAI;AAAA,QACL,EAAE,OAAO,KAAK;AAAA,QACd,EAAE,QAAQ;AAAA,QACV,EAAE,OAAO;AAAA,QACT,EAAE,IAAI;AAAA,QACN,EAAE,MAAM;AAAA,QAER;AAAA;AAAA;AAhBO;AAoBT,8BAA0B,KAAa;AACtC;AAEA,QAAE,MAAM,MAAM,CAAC,OAAO;AACrB,WAAG,IAAI,EAAE,SAAS,GAAG,EAAE,MAAM;AAAA;AAG9B,QAAE,IAAI;AAAA,QACL,EAAE,OAAO;AAAA,QACT,EAAE,QAAQ;AAAA,QACV,EAAE,OAAO;AAAA,QACT,EAAE,IAAI,EAAE;AAAA,QACR,EAAE,EAAE;AAAA,QACJ,EAAE,MAAM;AAAA,QACR;AAAA,QAEA;AAAA;AAAA;AAhBO;AAoBT,2BAAuB,SAAiB;AACvC,UAAI,CAAC,KAAK,SAAS,IAAI;AAAU,cAAM,IAAI,MAAM,IAAI;AAErD,WAAK,aAAa;AAClB,WAAK,WAAW;AAEhB;AAAA;AANQ;AAST,yBAAqB,MAAc;AAClC;AAEA,YAAM,MAAM,EAAE,KAAK,MAAM,EAAE,MAAM;AAEjC,WAAK,WAAW,KAAK;AAAA;AALb;AAQT,yBAAqB;AACpB,UAAI,KAAK,QAAQ,SAAS,KAAK;AAAW,eAAO;AAEjD,WAAK;AACL,eAAS,KAAK,SAAS,IAAI,KAAK,YAAY,KAAK;AAAA;AAJzC;AAOT,sBAAkB,OAAO;AACxB,UAAI,MAAM,QAAQ;AACjB,mBAAW,KAAK;AAAO,eAAK,SAAS;AAAA,aAEjC;AACJ;AAAA;AAAA;AALO;AAWT,MAAE,MAAM,MAAM,CAAC,SAAS;AA9QzB;AA+QE,UAAI;AAEJ,QAAE,OAAO,CAAC,eAAe,cAAc;AAEvC,UAAI,aAAO,YAAP,mBAAgB,QAAQ;AAC3B,oBAAY,EAAE,IAAI;AAAA,UACjB,EAAE,OAAO;AAAA,UACT,EAAE,OAAO;AAAA,UACT,EAAE,MAAM;AAAA,UACR,EAAE,EAAE;AAAA,UACJ,EAAE,IAAI,EAAE,UAAU,GAAG,EAAE,WAAW;AAAA;AAAA,aAG/B;AACJ,oBAAY,EAAE,IAAI;AAAA,UACjB,EAAE,KAAK,OAAO,SAAS,EAAE,SAAS,OAAO,UAAU,EAAE,WAAW;AAAA,UAChE,EAAE,OAAO;AAAA,UACT,EAAE,MAAM;AAAA,UACR,EAAE,EAAE;AAAA,UACJ,EAAE,IAAI,EAAE,UAAU,GAAG,EAAE,WAAW;AAAA;AAAA;AAIpC,QAAE,OAAO,MAAM;AACd,aAAK,UAAU,EAAE,IAAI;AAAA,UACpB,EAAE,KAAK,IAAI;AAAA,YACV,MAAM;AAAA,YACN,OAAO,UAAU,QAAQ;AAAA;AAAA,UAE1B,EAAE,MAAM;AAAA,UACR,EAAE,EAAE;AAAA,UACJ,EAAE,IACD,UAAU,IAAI,IACb,UAAU,QAAQ,IAAI,IACtB,UAAU,SAAS;AAAA;AAKtB,aAAK,UAAU,EAAE,IAAI;AAAA,UACpB,EAAE,KAAK,IAAI,EAAE,MAAM;AAAA,UACnB,EAAE,MAAM;AAAA,UACR,EAAE,EAAE;AAAA,UACJ,EAAE,IACD,UAAU,IAAI,IACb,UAAU,QAAQ,IAAI,IACtB,UAAU,SAAS;AAAA;AAKtB;AAAA;AAKD,QAAE,SAAS,MAAM;AAChB,YAAI,EAAE,oBAAoB,EAAE,aAAa,UAAU;AAClD;AAAA;AAAA;AAAA;AAOH,WAAO;AAAA,MACN,YAAY,oBAAI;AAAA,MAChB,UAAU,oBAAI;AAAA,MACd,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,MAAM;AAAA,MAIN,QAAQ,GAAe;AACtB,iBAAS;AAAA;AAAA,MAKV,UAAU,IAAY,MAAc,QAAgB;AACnD,eAAO,KAAK,WAAW,IAAI,IAAI;AAAA,UAC9B;AAAA,UACA;AAAA;AAAA;AAAA,MAIF,QAAQ,OAAe,QAAa;AACnC,YAAI,KAAK,SAAS,IAAI,QAAQ;AAC7B,gBAAM,IAAI,MAAM,uCAAuC;AAAA;AAGxD,eAAO,KAAK,SAAS,IAAI,OAAO;AAAA;AAAA,MAKjC,MAAM,QAAgB;AACrB,eAAO,MAAM,MAAM;AAAA;AAAA,MAGpB,KAAK,IAAY,QAAgB;AAChC,eAAO,MAAM,MAAM,QAAQ,KAAK,WAAW,IAAI;AAAA;AAAA,MAGhD,KAAK,QAAgB,QAAqC,UAAU;AACnE,eAAO,MAAM,cAAc,KAAK,WAAW,IAAI,SAAS;AAAA;AAAA,MAGzD,GAAG,QAAgB;AAClB,eAAO,MAAM,iBAAiB;AAAA;AAAA,MAG/B,KAAK,SAAiB;AACrB,eAAO,MAAM,cAAc;AAAA;AAAA,MAG5B,MAAM,MAAc;AACnB,eAAO,MAAM,YAAY;AAAA;AAAA,MAG1B,MAAM,WAAmB,OAAO;AAC/B,eAAO,MAAM;AACZ,YAAE;AAEF,eAAK,WAAW,QAAQ,CAAC,MAAM,EAAE;AAEjC,YAAE,GAAG;AAAA;AAAA;AAAA;AAAA;AAlPe;",
  "names": []
}
