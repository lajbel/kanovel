{
  "version": 3,
  "sources": ["../code/kanovel.ts"],
  "sourcesContent": ["import { KaboomCtx, Vec2 } from \"kaboom\";\n\n// Typescript Definitions for KaNovel \uD83D\uDC8B\n\ninterface Character {\n\tname: string;\n\tsprite: string;\n\texpressions: CharacterExpression[]\n}\n\ninterface CharacterExpression {\n\tname: string;\n\tsprite: string;\n}\n\ninterface KaNovelOpt {\n\ttextboxSprite: string;\n}\n\ndeclare global {\n\t/**\n\t * Simply config your Visual Novel\n\t*/\n\tfunction kanovel(\n\t\tconfig: KaNovelOpt\n\t);\n\n\t/**\n\t * Define a Character\n\t *\n\t * @example\n\t * ```js\n\t * character(\"b\", \"Beany\", \"beany\");\n\t * ```\n\t */\n\tfunction character(\n\t\t/**\n\t\t * Identifier to use the character\n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Name of the character for appears on the game\n\t\t */\n\t\tname: string,\n\t\t/**\n\t\t * Default sprite for use it whit show()\n\t\t */\n\t\tdefaultSprite?: string,\n\t\t/**\n\t\t * Expressions of the Character\n\t\t*/\n\t\texpressions?: CharacterExpression,\n\t): void;\n\n\t/**\n\t * Define a chapter\n\t *\n\t * @example\n\t * ```js\n\t * chapter(\"start\", () => [\n\t *    prota(\"Ohh today is a great day!\"),\n\t *    prota(\"I want...\"),\n\t *    prota(\"I want to live a visual novel life!\"),\n\t * ]);\n\t * ```\n\t */\n\tfunction chapter(\n\t\t/**\n\t\t * The title of the chapter\n\t\t */\n\t\ttitle: string,\n\t\t/**\n\t\t * Events of the chapter\n\t\t */\n\t\tevents: any[]\n\t): void;\n\n\t/**\n\t * Jump to other chapter\n\t */\n\tfunction jump(\n\t\tchapter: string\n\t): void;\n\n\t/**\n\t * Write as the protagonist or a narrator\n\t */\n\tfunction prota(dialog: string): void;\n\n\t/**\n\t * Write as a character\n\t */\n\tfunction char(\n\t\t/**\n\t\t * The character's id \n\t\t */\n\t\tid: string,\n\t\t/**\n\t\t * Text to say\n\t\t */\n\t\ttext: string,\n\t): void;\n\n\t/**\n\t * Show a character\n\t*/\n\tfunction show(\n\t\tcharId: string,\n\t\talign: \"center\" | \"left\" | \"right\",\n\t): void;\n\n\t/**\n\t * Show a background\n\t*/\n\tfunction bg(\n\t\t/**\n\t\t * Background's sprite\n\t\t*/\n\t\tsprite: string,\n\t): void;\n}\n\n// Custom Components\n\nfunction fade() {\n\tlet lastTime = 0;\n\t\n    return {\n        id: \"fade\",\n        require: [ \"opacity\" ],\n        update() {\n            if(this.opacity < 1 && time() > lastTime) {\n\t\t\t\tlastTime = time() + 0.010;\n\n\t\t\t\tthis.opacity += 0.025;\n\t\t\t}\n        },\n    }\n}\n\n// KaNovel Plugin\nexport default function kanovelPlugin(k: KaboomCtx) {\n\tk.scene(\"vn\", (data) => {\n\t\tk.layers([\"backgrounds\", \"characters\", \"textbox\"]);\n\n\t\tconst textboxBG = k.add([\n\t\t\tk.sprite(\"textbox\"),\n\t\t\tk.origin(\"bot\"),\n\t\t\tk.layer(\"textbox\"),\n\t\t\tk.z(0),\n\t\t\tk.pos(k.width() / 2, k.height() - 20),\n\t\t]);\n\n\t\tonLoad(() => {\n\t\t\tthis.textbox = add([\n\t\t\t\ttext(\"\", { size: 30, width: textboxBG.width - 50 }),\n\t\t\t\tlayer(\"textbox\"),\n\t\t\t\tz(1),\n\t\t\t\tpos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 50 /*pad*/,\n\t\t\t\t\t\ttextboxBG.height - 30 /*pad*/\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tthis.namebox = add([\n\t\t\t\ttext(\"\", { size: 40 }),\n\t\t\t\tlayer(\"textbox\"),\n\t\t\t\tz(2),\n\t\t\t\tpos(\n\t\t\t\t\ttextboxBG.pos.sub(\n\t\t\t\t\t\ttextboxBG.width / 2 - 30,\n\t\t\t\t\t\ttextboxBG.height + 30\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t]);\n\n\t\t\tthis.passDialogue();\n\t\t});\n\n\t\t// Default input for Visual Novel\n\t\tonUpdate(() => {\n\t\t\tif (isMousePressed() || isKeyPressed(\"space\")) {\n\t\t\t\tthis.passDialogue();\n\t\t\t}\n\t\t});\n\t});\n\n\t// THE REAL KANOVEL PLUGIN \uD83E\uDD8B\uD83E\uDD8B\uD83E\uDD8B\n\n\treturn {\n\t\tcharacters: new Map<string, Character>(),\n\t\tchapters: new Map(),\n\t\tcurDialog: \"\",\n\t\tcurChapter: \"start\",\n\t\tcurEvent: 0,\n\n\t\t// Kanovel Config function\n\n\t\tkanovel() {\n\n\t\t},\n\n\t\t// Visual Novel Making Functions\n\n\t\tcharacter(id: string, name: string, sprite: string) {\n\t\t\treturn this.characters.set(id, {\n\t\t\t\tname: name,\n\t\t\t\tsprite: sprite,\n\t\t\t});\n\t\t},\n\n\t\tchapter(title: string, events: any) {\n\t\t\tif (this.chapters.get(title)) {\n\t\t\t\tthrow new Error(`You can't repeat the chapter name! \"${title}\"`);\n\t\t\t}\n\n\t\t\treturn this.chapters.set(title, events());\n\t\t},\n\n\t\tjump(chapter: string) {\n\t\t\treturn () => this.changeChapter(chapter);\n\t\t},\n\n\t\t// History making functions\n\n\t\tprota(dialog: string) {\n\t\t\treturn () => this.write(\"\", dialog);\n\t\t},\n\n\t\tchar(id: string, dialog: string) {\n\t\t\treturn () => this.write(this.characters.get(id), dialog);\n\t\t},\n\n\t\tshow(charId: string, align: \"center\" | \"left\" | \"right\") {\n\t\t\treturn () => this.showChar(this.characters.get(charId), align);\n\t\t},\n\n\t\tbg(sprite: string) {\n\t\t\treturn () => this.changeBackground(sprite);\n\t\t},\n\n\t\t// Core Functions\n\n\t\twrite(char: any, dialog: string) {\n\n\t\t\tthis.textbox.text = \"\";\n\n\t\t\tif (char) {\n\t\t\t\tthis.namebox.text = char.name;\n\t\t\t\tthis.curDialog = '\"' + dialog + '\"';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.namebox.text = \"\";\n\t\t\t\tthis.curDialog = dialog;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < this.curDialog.length; i++) {\n\t\t\t\twait(0.05 * i, () => (this.textbox.text += this.curDialog[i]));\n\t\t\t}\n\t\t},\n\n\t\tcheckAction(action) {\n\t\t\tif (action.length) {\n\t\t\t\tfor (const act of action) this.checkAction(act);\n\t\t\t} else {\n\t\t\t\taction();\n\t\t\t}\n\t\t},\n\n\t\tpassDialogue() {\n\t\t\tif (this.textbox.text !== this.curDialog) return;\n\n\t\t\tthis.checkAction(this.chapters.get(this.curChapter)[this.curEvent]);\n\n\t\t\tthis.curEvent++;\n\t\t},\n\n\t\tshowChar(char: Character, align: \"center\" | \"left\" | \"right\") {\n\t\t\tlet charPos: Vec2 = k.vec2(0, 0);\n\n\t\t\tif (align === \"center\") charPos = k.center();\n\t\t\telse if (align === \"left\") charPos = k.vec2(k.width() / 4, k.height() / 2);\n\t\t\telse if (align === \"right\") charPos = k.vec2(k.width() / 2 + k.width() / 4, k.height() / 2);\n\t\t\telse charPos = k.center();\n\n\t\t\tk.add([\n\t\t\t\tk.sprite(char.sprite),\n\t\t\t\tk.origin(\"center\"),\n\t\t\t\tk.pos(charPos),\n\t\t\t\tk.layer(\"characters\"),\n\t\t\t\tk.opacity(0),\n\t\t\t\t\n\t\t\t\tfade(),\n\t\t\t]);\n\t\t},\n\n\t\tchangeBackground(spr: string) {\n\t\t\tk.every(\"bg\", (bg) => {\n\t\t\t\tbg.use(k.lifespan(1, { fade: 0.5 }));\n\t\t\t});\n\n\t\t\tconst bg = k.add([\n\t\t\t\tk.sprite(spr),\n\t\t\t\tk.opacity(0),\n\t\t\t\tk.origin(\"center\"),\n\t\t\t\tk.pos(k.center()),\n\t\t\t\tk.z(0),\n\t\t\t\tk.layer(\"backgrounds\"),\n\t\t\t\t\"bg\",\n\n\t\t\t\tfade(),\n\t\t\t]);\n\n\t\t\tbg.use(z(0));\n\t\t},\n\n\t\tchangeChapter(chapter: string) {\n\t\t\tif (!this.chapters.get(chapter)) throw new Error(`\"${chapter} chapter don't exists!\"`);\n\n\t\t\tthis.curChapter = chapter;\n\t\t\tthis.curEvent = 0;\n\n\t\t\tthis.passDialogue();\n\t\t},\n\t};\n}\n"],
  "mappings": "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",
  "names": []
}
